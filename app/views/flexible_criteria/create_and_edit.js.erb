if (@criteria.count > 2) {

  jQuery('#flexible_criteria_pane_list').append("<%= escape_javascript("#{render :partial => 'flexible_criterion', :locals => {:criterion =>   
  @criterion, :location => :last }}").html_safe %>");

  jQuery('#criterion_#{@criteria[-2].id}').replaceWith("<%= escape_javascript(render 
  :partial => 'flexible_criterion', 
  :locals => {:criterion => @criteria[-2], :location => :middle}).html_safe %>")
	}


elsif (@criteria.count == 2){

  jQuery('#flexible_criteria_pane_list').append("<%= escape_javascript("#{render :partial => 'flexible_criterion', :locals => {:criterion =>   
  @criterion, :location => :last }}").html_safe %>");

  jQuery('#criterion_#{@criteria.first.id}').replaceWith("<%= escape_javascript(render 
  :partial => 'flexible_criterion', 
  :locals => {:criterion => @criteria.first, :location => :first}).html_safe %>")
	}

else {

  jQuery('#flexible_criteria_pane_list').append("<%= escape_javascript("#{render :partial => 'flexible_criterion', :locals => {:criterion =>   
  @criterion, :location => :single }}").html_safe %>");
	}

jQuery('#new_flexible_criterion').remove()

page.replace_html 'flexible_edition_pane_menu',
                  :partial => 'criterion_editor',
                  :locals => {:criterion => @criterion}

page.replace_html "criteria_total_mark", @criterion.assignment.total_mark

page.sortable 'flexible_criteria_pane_list',
              :constraint => :vertical,
              :url => update_positions_assignment_flexible_criteria_path(:aid => @criterion.assignment.id)
