<%= javascript_include_tag "PeriodDeltaChain/PeriodDeltaChain" %>
<%= calendar_date_select_includes "silver" %>

<%= render :partial => 'boot.js' %>

<div class="wrapLeft">
<% form_for :assignment, @assignment do |f| %>
<%= f.error_messages%>
<fieldset>
  <legend>Assignment Properties</legend>
    <%= f.label :name, "Short Identifier" %>
    <%= f.text_field :name, :onchange =>  "$('assignment_repository_folder').setValue($(this).getValue())"%><br />
    <%= f.label :description, "Title" %>
    <%= f.text_field :description %><br />
    <%= f.label :message %>
    <%= f.text_area :message, :rows => 5, :col => 45 %><br />
    <%= f.label :due_date, "Due Date:"%>
    <%= f.calendar_date_select :due_date, {
          :time => "mixed",
          :year_range => 0.years.ago..1.years.from_now} %>

</fieldset>

<fieldset>
  <legend>Submitted Files</legend>
     <%= f.label :repository_folder, "Repository Folder"%>
    /<%= f.text_field :repository_folder%>
  <h4>Add filename(s) that students would be required to submit:</h4>
   <div id="assignment_files">
     <% f.fields_for :assignment_files do |assignment_file_form| %>
       <%= render :partial => 'assignment_file', :locals => {:assignment_file => assignment_file_form.object, :form => f} %>
     <% end %>
   </div>
   <p id="assignment_file_add_link">
     <%= add_assignment_file_link "Add a Required File", f %>
   </p>
</fieldset>

<fieldset>
  <legend>Assignment Type</legend>
  <p id="is_group_assignment_style">
  <%= check_box_tag "is_group_assignment", true, false, :id => "is_group_assignment", :onchange => "toggle_group_assignment($F('is_group_assignment'))"%>
    Students can work in groups
  </p>
 <p id="persist_groups_assignment_style" <%='style="display:none;"' unless @assignments.size > 0 %> class="disable">
   <%= check_box_tag "persist_groups", true, false, :id => "persist_groups", :onclick => "toggle_persist_groups($(this).getValue());", :disabled => true%>
  Persist Groups / Properties from 
  <select id="persist_groups_assignment" name="persist_groups_assignment" onChange="<%= remote_function(:url => {:action => "update_group_properties_on_persist"}, :with => "'assignment_id=' + $F('persist_groups_assignment')")%>" disabled>
    <% @assignments.each do |assignment| %>
    <option value="<%= h(assignment.id) %>"><%= h(assignment.name)%></option>
    <% end %>
  </select>
 </p>
  <fieldset class="group_properties">
    <legend>Group Properties</legend>
    <div id="group_properties" class="disabled">
  <p id="student_form_groups_style" class="disable">
    Allow students to form their own groups
    <%= f.check_box :student_form_groups, :id => "student_form_groups", :onchange => "toggle_student_form_groups($F('student_form_groups'))"%>
  </p>

  <p id="group_limit_style" class="disable">
    Group Limit <span class="assignment_info">(must be 1 or more):</span>
    from <%= f.text_field :group_min, :size => 5, :maxlength => 3%>
    to <%= f.text_field :group_max, :size => 5, :maxlength => 3%>
    people in a group.
  </p>

  <p id="group_name_autogenerated_style" class="disable">
    Group's names autogenerated:
    <%= f.check_box :group_name_autogenerated %>
  </p>
</div>
  </fieldset>
</fieldset>

<fieldset>
  <legend>Submission Rules</legend>
    <div>
      <span class="due_date">The Due Date is <b><%=Time.now%></b></span>
    </div>

  <% f.fields_for :submission_rule do |rule| %>
    <h5>Choose penalty rules to apply for late submissions:</h5>

    <p>
      <%= rule.radio_button :type, "NoLateSubmissionRule", :checked => true %>
      Accept no late submissions
    </p>

    <p>
      <%= rule.radio_button :type, "GracePeriodSubmissionRule", :onchange => "$$('.period').each(function(node){node.remove();});" %>
      Automatically deduct grace period credits
      <span class="grace_periods_link">
        <%= add_grace_period_link "Add a Grace Period", rule %>
      </span>
    </p>
    <div id="grace_periods">
    <% if rule.object.type.to_s == "GracePeriodSubmissionRule" %>
     <% rule.fields_for :periods do |period_form| %>
       <%= render :partial => 'grace_period', :locals => {:grace_period => period_form.object, :pf => rule} %>
     <% end %>
    <% end %>
    </div>
    <p>
      <%= rule.radio_button :type, "PenaltyPeriodSubmissionRule", :onchange => "$$('.period').each(function(node){node.remove();});" %>
      Use Penalty Formula  
      <span class="penalty_periods_link">
        <%= add_penalty_period_link "Add a Penalty Period", rule %>
      </span>
    </p>

    <div id="penalty_periods">
    <% if rule.object.type.to_s == "PenaltyPeriodSubmissionRule" %>
     <% rule.fields_for :periods do |period_form| %>
       <%= render :partial => 'penalty_period', :locals => {:penalty_period => period_form.object, :pf => rule} %>
     <% end %>
    <% end %>
    </div>
    
    <p>

    </p>
  <%- end -%>
  

</fieldset>  

<%= f.submit "Submit" %>
<% end %>

</div>
</div>
