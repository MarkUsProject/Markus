<% is_viewing_a_peer_review_result = !@result.nil? && @result.is_a_review? %>

<ul class='sub'>
  <li id='dropdown'>
    <div class='dropdown'>
      <%# Display an appropriate message in the dropdown menu %>
      <% if assessment.nil? %>
        <%= t('menu.choose') %>
      <% elsif assessment.new_record? %>
        <%= t('helpers.submit.create', model: assessment.class.model_name.human) %>
      <% else %>
        <% title = assessment.short_identifier %>
        <% if assessment.is_a?(Assignment) && assessment.is_peer_review? %>
          <% title = "#{assessment.parent_assignment.short_identifier} #{PeerReview.model_name.human}" %>
        <% end %>
        <% if assessment.is_hidden %>
          <% title = t('assignments.hidden', assignment_text: title) %>
        <% end %>
        <%= title %>
      <% end %>
      <ul>
        <%= render partial: 'shared/assignments_dropdown_menu' %>
      </ul>
    </div>
  </li>

  <% if assessment.is_a?(GradeEntryForm) && !assessment.new_record? %>
    <li class='<%= "active" if controller.action_name == 'edit' %>'>
      <%= link_to t('menu.properties'),
                  edit_grade_entry_form_path(assessment) %>
    </li>
    <li class='<%= "active" if controller.action_name == 'grades' %>'>
      <%= link_to GradeEntryForm.human_attribute_name(:grades),
                  grades_grade_entry_form_path(assessment) %>
    </li>
    <li class='<%= "active" if controller.controller_name == 'marks_graders' %>'>
      <%= link_to Ta.model_name.human.pluralize,
                  grade_entry_form_marks_graders_path(assessment) %>
    </li>
  <% elsif assessment.is_a?(Assignment) && !assessment.new_record? %>
    <% target_id = is_viewing_a_peer_review_result ? assessment.pr_assignment.id :
                                                     assessment.id %>
    <li <% if ['criteria',
               'annotation_categories',
               'automated_tests',
               'exam_templates'].include?(controller.controller_name) ||
      (controller.controller_name == 'assignments' &&
        controller.action_name != 'summary' && controller.action_name != 'batch_runs') %>
        class='active'
        <% end %>
    >
      <%= link_to t('menu.settings'),
                  edit_assignment_path(target_id) %>
    </li>
    <li class='<%= "active" if controller.controller_name == 'groups' %>'>
      <%= link_to Group.model_name.human.pluralize,
                  assignment_groups_path(target_id) %>
    </li>
    <% if assessment.is_peer_review? || is_viewing_a_peer_review_result %>
      <li class='<%= 'active' if controller.controller_name == 'peer_reviews' %>'>
        <%= link_to t('peer_reviews.assign'),
                    assignment_peer_reviews_path(target_id) %>
      </li>
    <% end %>
    <li class='<%= "active" if controller.controller_name == 'graders' %>'>
      <%= link_to Ta.model_name.human.pluralize,
                  assignment_graders_path(target_id) %>
    </li>
    <li
      <% if controller.controller_name == 'submissions' ||
            controller.controller_name == 'results' %>
        class='active'
      <% end %>
    >
      <%= link_to assessment.is_peer_review? || is_viewing_a_peer_review_result ?
                    PeerReview.model_name.human.pluralize : Submission.model_name.human.pluralize,
                  browse_assignment_submissions_path(target_id) %>
    </li>
    <% unless assessment.is_peer_review? || is_viewing_a_peer_review_result %>
      <li class='<%= "active" if controller.controller_name == 'assignments' && controller.action_name == 'summary' %>'>
        <%= link_to t('results.summary'),
                    summary_assignment_path(target_id) %>
      </li>
    <% end %>
    <% if assessment.enable_test %>
      <li class='<%= "active" if controller.controller_name == 'assignments' && controller.action_name == 'batch_runs' %>'>
        <%= link_to t('automated_tests.test_runs_status'),
                    batch_runs_assignment_path(target_id) %>
      </li>
    <% end %>
  <% end %>
</ul>
