<% content_for :head do %>
  <%= javascript_include_tag 'Groups/index', nonce: true %>

  <%= javascript_tag nonce: true do %>
    <% parts = @assignment.duration_parts
       duration_string = ["#{parts[:hours]} #{I18n.t('durations.hours', count: parts[:hours])}",
                          "#{parts[:minutes]} #{I18n.t('durations.minutes', count: parts[:minutes])}"].join(', ') %>
    document.addEventListener('DOMContentLoaded', () => {
      window.groupsManager = makeGroupsManager(document.getElementById('groups-manager'),
        {
          course_id: <%= @current_course.id %>,
          assignment_id: <%= @assignment.id %>,
          group_name_autogenerated: <%= @assignment.group_name_autogenerated %>,
          can_create_all_groups: <%= @assignment.group_max == 1 && !@assignment.scanned_exam? %>,
          groupMin: <%= @assignment.group_min %>,
          scanned_exam: <%= @assignment.scanned_exam? %>,
          timed: <%= @assignment.is_timed %>,
          current_duration: '<%= duration_string %>',
          vcs_submit: <%= @assignment.vcs_submit.to_json %>
        }
      );
    });
  <% end %>
<% end %>

<% content_for :title do %>
    <%= t('groups.manage_groups') %>
    <div class='title-help'>
      <p>
        <%= t('groups.help') %>
      </p>
    </div>
<% end %>

<% content_for :additional_headings do %>
  <%# Allow cloning groups forward only if vcs submits are allowed for this assignment. %>
  <div id="groups-header"></div>
  <%= link_to t('download'), '#', id: 'downloadModal' %>
  <span class='menu_bar'></span>
  <%= link_to t('upload'), '#', id: 'uploadModal' %>
  <% if @assignment.scanned_exam %>
    <span class='menu_bar'></span>
    <%= link_to t('exam_templates.assign_scans.title'), :assign_scans_course_assignment_groups %>
  <% end %>
<% end %>

<div id='groups-manager'></div>
<div id='groups_manager'></div>

<!-- Modals -->
<%= render partial: 'download_modal', layout: 'layouts/modal_dialog' %>
<%= render partial: 'upload_modal', layout: 'layouts/modal_dialog' %>
<%= render partial: 'rename_group_modal', layout: 'layouts/modal_dialog' %>
<aside class='markus-dialog' id='notes_dialog'></aside>
