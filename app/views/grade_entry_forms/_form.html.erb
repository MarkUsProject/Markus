<% # Grade entry creation form
   # #{short_identifier} - An identifier for this grade entry form
   # #{description} - A name for this grade entry form
   # #{message} - Some additional information about this grade entry form
   # #{date} - The date the exam/test/lab corresponding to this grade entry form took place
   # #{grade_entry_item(s)} - Column name and total
%>
<%
  # For the internationalization of the Calendar
%>

<% content_for :head do %>
  <%= javascript_include_tag 'jquery', 'jquery-ui' %>
  <%= stylesheet_link_tag 'jquery-ui' %>
  <%= javascript_include_tag 'localize_date' %>
<% end %>

<%= render :partial => 'boot',
           :formats => [:js],
           :handlers => [:erb] %>

<div class='wrapLeft'>
  <%= render 'shared/flash_message' %>

  <%= form_for @grade_entry_form, :as => :grade_entry_form do |f| %>
    <%= render :partial => 'shared/error_explanation',
               :locals => { :model => @grade_entry_form } %>

    <fieldset>
      <legend><%= t('grade_entry_forms.properties') %></legend>

        <% # Basic grade entry form properties %>

        <div>
          <%= raw(f.label :short_identifier,
                          t(:short_identifier),
                          :class => 'required_field') %>
          <%= raw(f.text_field :short_identifier) %>
        </div>

        <div>
          <%= raw(f.label :description, t(:description)) %>
          <%= raw(f.text_field :description) %>
        </div>

        <div>
          <%= raw(f.label :message) %>
          <%= raw(f.text_area :message, :rows => 8, :cols => 65) %>
        </div>

        <div>
          <%= raw(f.label :date,
                          t(:shortened_date),
                          :class => 'required_field') %>
          <%= raw(f.text_field :date,
                               :id => 'actual_date',
                               :class => 'hidden') %>
          <%= text_field_tag 'date',
                             nil,
                             { :class => 'datepicker',
                               :size => 30 } %>
        </div>

        <div>
          <%= raw(f.label :show_total, t('grade_entry_forms.show_total')) %>
          <%= raw(f.check_box :show_total) %>
        </div>

        <br>

        <h4><%= t('grade_entry_forms.specify_columns') %></h4>
        <% # Display the column names and totals
        %>
        <div id='grade_entry_items'>
          <% # Ensures there is at least one column whenever the form is loaded. %>
          <% if @grade_entry_form.grade_entry_items.empty? %>
            <%= render(:partial => 'grade_entry_item',
                       :locals => { :form => f,
                                    :new_position => 0,
                                    :grade_entry_item => GradeEntryItem.new }) %>
          <% end %>

          <% sort_items_by_position(@grade_entry_form.grade_entry_items).each_with_index do |item, index| %>
            <%= f.fields_for :grade_entry_items, item do |entry_item| %>
              <%= render :partial => 'grade_entry_item',
                         :locals => { :grade_entry_item => entry_item.object,
                                      :new_position => index + 1,
                                      :form => f } %>
            <% end %>
          <% end %>
        </div>

        <% # Allow the user to add a new column to the form %>
        <p id='grade_entry_item_add_link'>
          <%= add_grade_entry_item_link t('grade_entry_forms.add_column'), f %>
        </p>
    </fieldset>

    <%= f.submit t('submit'),
                 :'data-disable-with' => t('working') %>
  <% end %>
</div>

<script>
  jQuery('.datepicker').datepicker({
    altField:     '#actual_date',
    altFormat:    'yy-mm-dd',
    numberOfMonths: 2,
    minDateTime:  0,
    secondMax:    0,
    dateFormat:   "<%= raw I18n.t('date.formats.locale_date_only') %>",
    monthNames:   <%= raw I18n.t('date.months') %>,
    dayNames:     <%= raw I18n.t('date.weekdays') %>,
    dayNamesMin:  <%= raw I18n.t('date.weekdays_min') %>,
    prevText:     "<%= I18n.t('time.prev') %>",
    nextText:     "<%= I18n.t('time.next') %>"
  });
</script>
