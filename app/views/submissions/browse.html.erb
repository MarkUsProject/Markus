<%= render partial: 'submissions_table', formats: [:'js.jsx'], handlers: [:erb] %>

<div class='notice'>
  <% if @assignment.past_collection_date? %>
     <%= t('browse_submissions.grading_can_begin') %>
  <% else %>
     <%= t('browse_submissions.grading_can_begin_after',
           time: I18n.l(@assignment.submission_rule.calculate_collection_time,
           format: :long_date)) %>
  <% end %>
</div>

<div class='title_bar'>
  <h1>
    <%= t('browse_submissions.submissions',
          short_identifier: sanitize(@assignment.short_identifier)) %>
    <div class='title-help submissions_help'>
      <p class='help-message-title submissions_help'>
        <% if @current_user.ta? %>
          <%= t('assignment.help.submissions_graders') %>
        <% else %>
          <%= t('assignment.help.submissions_admins') %>
        <% end %>
      </p>
    </div>
  </h1>

  <div class='heading_buttons'>
    <% if @current_user.admin? %>
      <%= link_to t('collect_submissions.collect_all'),
                  collect_all_submissions_assignment_submissions_path(
                    @assignment.id),
                  confirm: t('collect_submissions.results_loss_warning') %>
      <span class='menu_bar'></span>
      <%= link_to t('browse_submissions.csv_report'),
                  download_simple_csv_report_assignment_submissions_path(
                    @assignment) %>
      <span class='menu_bar'></span>
      <%= link_to t('browse_submissions.detailed_csv_report'),
                  download_detailed_csv_report_assignment_submissions_path(
                    @assignment) %>
      <span class='menu_bar'></span>
      <%= link_to t('browse_submissions.subversion_repo_list'),
                  download_svn_repo_list_assignment_submissions_path(
                    @assignment) %>
      <span class='menu_bar'></span>
      <%= link_to t('browse_submissions.subversion_checkout_file'),
                  download_svn_checkout_commands_assignment_submissions_path(
                    @assignment) %>
      <span class='menu_bar'></span>
    <% end %>

    <% # Allow TA submission collection only if all the submissions are
       # assignment to exactly one TA. %>
    <% if @current_user.ta? and @assignment.past_collection_date? and
          @groupings.all? {|grouping| grouping.get_ta_names.size == 1} %>
      <%= link_to t('collect_submissions.collect_ta'),
                  collect_ta_submissions_assignment_submissions_path(
                    @assignment),
                  confirm: t('collect_submissions.results_loss_warning') %>
      <span class='menu_bar'></span>
    <% elsif @current_user.ta? and @assignment.past_collection_date? %>
      <a id='disable' title='<%= t('collect_submissions.disable_collect') %>'>
        <%= t('collect_submissions.collect_ta') %>
      </a>
      <span class='menu_bar'></span>
    <% end %>
    <!-- OLD -->
  <%= form_tag update_submissions_assignment_submissions_path(@assignment) %>
    <div class="ap_nav_box">
      <% if @current_user.admin? %>
        <div class="floatLeft">
          <%= submit_tag I18n.t("browse_submissions.release_marks"),
            :name => "release_results" %>
          <%= submit_tag I18n.t("browse_submissions.unrelease_marks"),
            :name => "unrelease_results" %>
          <!-- ATE_SIMPLE_UI: this is temporary. The buttons here should change into a drop down. See bulk actions in user table UI. -->
          <%= submit_tag I18n.t("browse_submissions.run_tests"),
                                :name => "run_test" %>
          <% if !@assignment.results_average.nil? %>
            <%= I18n.t("browse_submissions.class_average",
                       :results_average => @assignment.results_average) %>
          <% end %>
        </div>
      <% end %>
      <!-- end -->

    <% if all_assignments_marked? %>
      <%= link_to t('browse_submissions.download_groupings_files'),
                  download_groupings_files_assignment_submissions_path(
                    groupings: @groupings) %>
    <% else %>
      <%= link_to t('browse_submissions.download_groupings_files'),
                  download_groupings_files_assignment_submissions_path(
                    groupings: @groupings),
                  confirm: t('collect_submissions.marking_incomplete_warning') %>
    <% end %>

    <% if @current_user.ta? %>
      <span class='menu_bar'></span>
      <%= t('browse_submissions.how_many_marked',
            num_marked: @current_user.get_num_marked(@assignment),
            num_assigned: @current_user.get_num_assigned(@assignment)) %>
    <% end %>
  </div>
</div>

  <!-- start old -->
<div class='wrapLeft'>
  <%= render partial: 'shared/flash_message' %>
  <div id='submissions_table'></div>
    <div id="ap_selects">
      <%= render :partial => 'ajax_paginate/selects',
        :locals => {:page_items => @groupings.size,
                    :total_items => @groupings_total} %>
    </div>

    <table>
      <thead id="submissions_table_head">
        <%= render  :partial => 'submissions_table_sorting_links',
                    :locals => {
                      :assignment => @assignment,
                      :filter => 'none',
                      :page => @current_page,
                      :per_page => @per_page,
                      :sort_by => @sort_by,
                      :desc => @desc } %>
      </thead>

      <%= render  :partial => 'submissions_table_body',
                  :locals => {
                    :groupings => @groupings,
                    :assignment => @assignment } %>

      <tfoot id="submissions_table_foot">
        <%= render  :partial => 'submissions_table_sorting_links',
                    :locals => {
                      :assignment => @assignment,
                      :filter => 'none',
                      :page => @current_page,
                      :per_page => @per_page,
                      :sort_by => @sort_by,
                      :desc => @desc } %>
      </tfoot>
    </table>


    <div class="ap_nav_box">
      <div class="ap_page_links" id="ap_page_links_2">
        <%= render  :partial => 'ajax_paginate/initial_paginate_links',
                    :locals => {
                      :per_page => @per_page,
                      :current_page => @current_page,
                      :page_items => @groupings.size,
                      :total_items => @groupings_total,
                      :assignment => @assignment,
                      :filter => @filter,
                      :sort_by => @sort_by,
                      :desc => @desc } %>
      </div>
      <div id="ap_selector">
        <%= render :partial => 'ajax_paginate/selector' %>
      </div>

      <div class="clear"></div>

      <div class="floatLeft">
        <% if @current_user.admin? %>
          <%= submit_tag I18n.t("browse_submissions.release_marks"),
                                :name => "release_results" %>
          <%= submit_tag I18n.t("browse_submissions.unrelease_marks"),
                                :name => "unrelease_results" %>
          <!-- ATE_SIMPLE_UI: this is temporary. The buttons here should change into a drop down. See bulk actions in user table UI. -->
          <%= submit_tag I18n.t("browse_submissions.run_tests"),
                                :name => "run_test" %>
        <% end %>
      </div>

      <div class="ap_filters" id="ap_filters_2">
        <%= render  :partial => 'submissions_table_filters',
                    :locals => {
                      :filter => @filter,
                      :page => @current_page,
                      :desc => @desc,
                      :sort_by => @sort_by,
                      :assignment => @assignment,
                      :filters => @filters,
                      :per_page => @per_page,
                      :per_pages => @per_pages } %>
      </div>
      <div class="clear"></div>
    </div>
  </form>

<!--end-->
</div>

